import os
from .constants import Shanten, SHANTEN_NAMES
from typing import *

# Collection of all the display-related functions.
# - Printing hands and tiles (pt, ph, print_pond) 
# - Printing round name, seat name, shanten name (round_name, relative_seat_name, shanten_name)

def pt_unicode(tile: int, doras: List[int] = [], is_sideways: bool = False) -> str:
    """print tile (2-char representation)"""
    TILE_REPRS = "ğŸ€‡ğŸ€ˆğŸ€‰ğŸ€ŠğŸ€‹ğŸ€ŒğŸ€ğŸ€ğŸ€ğŸ€™ğŸ€šğŸ€›ğŸ€œğŸ€ğŸ€ğŸ€ŸğŸ€ ğŸ€¡ğŸ€ğŸ€‘ğŸ€’ğŸ€“ğŸ€”ğŸ€•ğŸ€–ğŸ€—ğŸ€˜ğŸ€€ğŸ€ğŸ€‚ğŸ€ƒğŸ€†ğŸ€…ğŸ€„ï¸"
    ret = "??"
    if tile < 20:
        ret = TILE_REPRS[tile - 11] + " "
    elif tile < 30:
        ret = TILE_REPRS[tile - 21 + 9] + " "
    elif tile < 40:
        ret = TILE_REPRS[tile - 31 + 18] + " "
    elif tile < 47:
        ret = TILE_REPRS[tile - 41 + 27] + " "
    elif tile == 47:
        # need to specially output ğŸ€„ï¸ so it's not an emoji
        ret = TILE_REPRS[-2:]
    elif tile == 50:
        ret = "ğŸ€« "
    elif tile == 51:
        ret = "ğŸ€‹Â·"
    elif tile == 52:
        ret = "ğŸ€Â·"
    elif tile == 53:
        ret = "ğŸ€”Â·"
    if tile in doras:
        ret += "\u20f0" # combining asterisk
    if is_sideways:
        ret = f"â‚{ret}â‚"
    return ret

def pt_discord(tile: int, doras: List[int] = [], is_sideways: bool = False) -> str:
    """Decides which discord emote to display for the given tile"""
    if tile in doras:
        return DISCORD_CALLED_DORA_TILES[tile] if is_sideways else DISCORD_DORA_TILES[tile]
    else:
        return DISCORD_CALLED_TILES[tile] if is_sideways else DISCORD_TILES[tile]

# print tile, print hand
pt = lambda tile, doras=[], is_sideways=False: pt_discord(tile, doras, is_sideways) if os.getenv("use_discord_tile_emoji") == "True" else pt_unicode(tile, doras, is_sideways)
ph = lambda hand, doras=[]: "".join(map(lambda t: pt(t, doras=doras), hand))

def print_pond(pond: Iterable[int], doras: List[int] = [], riichi_index: Optional[int] = None) -> str:
    if riichi_index is None:
        return ph(pond, doras)
    else:
        i = riichi_index
        pond = tuple(pond)
        return ph(pond[:i], doras) + pt(pond[i], is_sideways=True) + ph(pond[i+1:], doras)

round_name = lambda rnd, honba: (f"East {rnd+1}" if rnd <= 3 else f"South {rnd-3}" if rnd <= 7 else f"West {rnd-7}" if rnd <= 11 else f"North {rnd-11}") + ("" if honba == 0 else f"-{honba}")
short_round_name = lambda rnd, honba: (f"E{rnd+1}" if rnd <= 3 else f"S{rnd-3}" if rnd <= 7 else f"W{rnd-7}" if rnd <= 11 else f"N{rnd-11}") + f"-{honba}"
relative_seat_name = lambda you, other: {0: "self", 1: "shimocha", 2: "toimen", 3: "kamicha"}[(other-you)%4]

def shanten_name(shanten: Shanten) -> str:
    if shanten[0] >= 2:
        return SHANTEN_NAMES[shanten[0]]
    else:
        return SHANTEN_NAMES[shanten[0]] + " accepting " + ph(shanten[1])

DISCORD_TILES = {
    11: "<:1m:1142707135021600830>",
    12: "<:2m:1142707491713593355>",
    13: "<:3m:1142707570251939880>",
    14: "<:4m:1142707571120160810>",
    15: "<:5m:1142707573192138792>",
    16: "<:6m:1142707574119079936>",
    17: "<:7m:1142707575108931665>",
    18: "<:8m:1142707576740520006>",
    19: "<:9m:1142707577357082655>",
    51: "<:0m:1142997164679770152>",

    21: "<:1p:1142707873802113044>",
    22: "<:2p:1142707875261726772>",
    23: "<:3p:1142707876159291512>",
    24: "<:4p:1142707877002358847>",
    25: "<:5p:1142707923605270590>",
    26: "<:6p:1142707925475930153>",
    27: "<:7p:1142707927292055562>",
    28: "<:8p:1142707928239964160>",
    29: "<:9p:1142707928885887040>",
    52: "<:0p:1142997170870550538>",

    31: "<:1s:1142707987526459455>",
    32: "<:2s:1142707989405519973>",
    33: "<:3s:1142707991351672982>",
    34: "<:4s:1142707992580603914>",
    35: "<:5s:1142707996460335155>",
    36: "<:6s:1142986859488751646>",
    37: "<:7s:1142986876144340992>",
    38: "<:8s:1142986885195640972>",
    39: "<:9s:1142986898017636382>",
    53: "<:0s:1142997176641929347>",

    41: "<:1z:1142986930422820996>",
    42: "<:2z:1142986936223531028>",
    43: "<:3z:1142987133599105065>",
    44: "<:4z:1142987139311734856>",
    45: "<:5z:1142987150984482989>",
    46: "<:6z:1142987158920106104>",
    47: "<:7z:1142987164406259733>",

    50: "<:1x:1142987199369986179>",
}

DISCORD_CALLED_TILES = {
    11: "<:1M:1147238374088917185>",
    12: "<:2M:1147238407597211768>",
    13: "<:3M:1147238414157095033>",
    14: "<:4M:1147238465247924225>",
    15: "<:5M:1147238469979095131>",
    16: "<:6M:1147238492120809472>",
    17: "<:7M:1147238496591954077>",
    18: "<:8M:1147238508839313540>",
    19: "<:9M:1147238545438818405>",
    51: "<:0M:1147238370435678228>",

    21: "<:1P:1147238375204593675>",
    22: "<:2P:1147238408595451906>",
    23: "<:3P:1147238415084027995>",
    24: "<:4P:1147238466766262332>",
    25: "<:5P:1147238472080445571>",
    26: "<:6P:1147238493714665472>",
    27: "<:7P:1147238498508738723>",
    28: "<:8P:1147238510600925337>",
    29: "<:9P:1147238544088240189>",
    52: "<:0P:1147238371161276477>",

    31: "<:1S:1147238377335300106>",
    32: "<:2S:1147238410877161483>",
    33: "<:3S:1147238416325558292>",
    34: "<:4S:1147238467735138394>",
    35: "<:5S:1147238473145794711>",
    36: "<:6S:1147238494620635136>",
    37: "<:7S:1147238499502788829>",
    38: "<:8S:1147238511720812614>",
    39: "<:9S:1147238562060828743>",
    53: "<:0S:1147238373099057172>",

    41: "<:1Z:1147238379499565088>",
    42: "<:2Z:1147238412374511776>",
    43: "<:3Z:1147238418477236346>",
    44: "<:4Z:1147238469140234260>",
    45: "<:5Z:1147238474282455100>",
    46: "<:6Z:1147238495723720776>",
    47: "<:7Z:1147238500727537774>",

    50: "<:1X:1147238378685861908>",
}

DISCORD_DORA_TILES = {
    11: "<:1md:1147275913319428216>",
    12: "<:2md:1147276023642210304>",
    13: "<:3md:1147276030151766037>",
    14: "<:4md:1147276133956591666>",
    15: "<:5md:1147276140088672417>",
    16: "<:6md:1147276278437773372>",
    17: "<:7md:1147276284318191687>",
    18: "<:8md:1147276427784355880>",
    19: "<:9md:1147276431957696632>",
    51: "<:0md:1147275908399509657>",

    21: "<:1pd:1147275914896494642>",
    22: "<:2pd:1147276025835835594>",
    23: "<:3pd:1147276031456202783>",
    24: "<:4pd:1147276135151980634>",
    25: "<:5pd:1147276141191778334>",
    26: "<:6pd:1147276280400711740>",
    27: "<:7pd:1147276285303853147>",
    28: "<:8pd:1147276428841341018>",
    29: "<:9pd:1147276433098559668>",
    52: "<:0pd:1147275909691346984>",

    31: "<:1sd:1147275915932467323>",
    32: "<:2sd:1147276027123482684>",
    33: "<:3sd:1147276032441860186>",
    34: "<:4sd:1147276136900993114>",
    35: "<:5sd:1147276142399717427>",
    36: "<:6sd:1147276281818398943>",
    37: "<:7sd:1147276286172090571>",
    38: "<:8sd:1147276430946865337>",
    39: "<:9sd:1147276434730139779>",
    53: "<:0sd:1147275911922729091>",

    41: "<:1zd:1147275919380185150>",
    42: "<:2zd:1147276027949764669>",
    43: "<:3zd:1147276033549152286>",
    44: "<:4zd:1147276138155089990>",
    45: "<:5zd:1147276143125352449>",
    46: "<:6zd:1147276282866966538>",
    47: "<:7zd:1147276287581372556>",

    50: "<:1xd:1147275917404680375>",
}

DISCORD_CALLED_DORA_TILES = {
    11: "<:1Md:1147277392931459156>",
    12: "<:2Md:1147277545868382328>",
    13: "<:3Md:1147277551765573735>",
    14: "<:4Md:1147277711652425788>",
    15: "<:5Md:1147277717113413632>",
    16: "<:6Md:1147277954922061945>",
    17: "<:7Md:1147277963688165406>",
    18: "<:8Md:1147278119145853038>",
    19: "<:9Md:1147278123046555781>",
    51: "<:0Md:1147277387747315782>",

    21: "<:1Pd:1147277394789539952>",
    22: "<:2Pd:1147277546929524797>",
    23: "<:3Pd:1147277552805748977>",
    24: "<:4Pd:1147277713141407825>",
    25: "<:5Pd:1147277719080542341>",
    26: "<:6Pd:1147277958592073801>",
    27: "<:7Pd:1147277965432987770>",
    28: "<:8Pd:1147278120248954890>",
    29: "<:9Pd:1147278124262887534>",
    52: "<:0Pd:1147277389622149355>",

    31: "<:1Sd:1147277396328845372>",
    32: "<:2Sd:1147277548733071440>",
    33: "<:3Sd:1147277554156306503>",
    34: "<:4Sd:1147277714735247543>",
    35: "<:5Sd:1147277720095572099>",
    36: "<:6Sd:1147277959716159649>",
    37: "<:7Sd:1147277967286861916>",
    38: "<:8Sd:1147278121926668348>",
    39: "<:9Sd:1147278126502653952>",
    53: "<:0Sd:1147277391660580954>",

    41: "<:1Zd:1147277398727991387>",
    42: "<:2Zd:1147277550029123654>",
    43: "<:3Zd:1147277555351687268>",
    44: "<:4Zd:1147277715968372747>",
    45: "<:5Zd:1147277721701986335>",
    46: "<:6Zd:1147277961196748853>",
    47: "<:7Zd:1147277968419344504>",

    50: "<:1Xd:1147277396878299148>",
}
